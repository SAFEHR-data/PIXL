# Parquet files you might encounter throughout PIXL

## OMOP-ES files

From
[OMOP-ES](https://github.com/SAFEHR-data/the-rolling-skeleton/blob/main/docs/design/100-day-design.md#data-flow-through-components)
we receive parquet files defining the data we need to export. These input files appear as 2 groups:

1. **Public** parquet files: have had identifiers removed and replaced with a sequential ID for the
   export
2. **Private** parquet files: map sequential identifiers to patient identifiers (e.g. MRNs,
   Accession numbers, NHS numbers)

## Radiology reports

These are supplied already de-identified as part of the OMOP extract.

They were formerly generated by the PIXL pipeline by passing the original reports through the
CogStack API, which returned a de-identified report, which was stored in a special radiology
parquet file.

## Radiology linker table

An output parquet file named `IMAGE_LINKER.parquet` that defines the connection between the
OMOP procedure_occurrence_id for the current extract and the pseudo image/study ID.
The procedure_occurrence_id can get renumbered from extract to extract.

See method `make_radiology_linker_table` for more.

## Exporting (copying from OMOP ES)

As part of the PIXL pipeline, we copy the OMOP-ES public _parquet_ files  to an export directory, to
prepare them for upload to the DSH. The exporting details are in the
[`pixl_core` documentation](../../pixl_core/README.md#omop-es-files).

## Uploading to the DSH

The final step in the journey of the _parquet_ files is to upload them to the DSH. This is
implemented and documented in [`pixl_core`](../../pixl_core/README.md#uploading-to-an-ftps-server).

## Testing

Various _parquet_ files are provided throughout the repo to enable unit and system testing:

- `test/resources/omop/` contains public and private parquet files together with an
  `extract_summary.json` file to mimic the input received from OMOP-ES for the system tests and cli unit tests

During the system test, a `radiology.parquet` file is generated and temporarily stored in
`projects/exports/test-extract-uclh-omop-cdm/latest/radiology/radiology.parquet` to check the successful
de-identification before the DSH upload. This file is then deleted after the test.
